---
title: "INTERESTING SALAMANDER TITLE HERE"
author: "Cori Lopazanski, Kai Kopecky"
date: "11/22/2019"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(janitor)
library(kableExtra)

salamander <- read_csv("mack_creek_vertebrates.csv") %>% 
  clean_names() %>% 
  filter(species == "DITE")
```

## Create Things Here

### Introduction

### Data and Methods
From Metadata: "Since 1987, we have been monitoring populations of West Slope cutthroat trout (Onchorhyncus clarki clarki) in two standard reaches of Mack Creek in the H.J. Andrews Experimental Forest. Beginning in 1993, we included monitoring of Pacific Giant Salamanders, Dicamptodon tenebrosus. The two standard reaches are in a section of clearcut forest (ca. 1963) and an upstream 500 year old coniferous forest. Sub-reaches are sampled with 2-pass electrofishing, and all captured vertebrates are measured and weighed. This study constitutes one of the longest continuous records of salmonid populations on record."

Site Code = coded name of sample area within Mack creek
Section = OG, old growth; CC, clear cut
Reach = reach sampled (in 50m distances); Lower (0-50), Middle (50-100), Upper (100-150)
Pass = electroshocking pass number
Unit Type = Cascade = C, Pool = P, Side-channel = SC, others (including IP = isolated pool)
Length 1 = snout to vent
Length 2 = snout to tail

### Results

#### A.

```{r}
# subset salamander dataframe to include only columns of interest and salamander counts for each year by forest section
salamander_abundance <- salamander %>% 
  select(year, section, species) %>% 
  mutate(species = ifelse(species == "DITE", 1, 0)) %>% 
  mutate(species = as.numeric(species)) %>% 
  mutate(section = ifelse(section == "OG", "Old Growth", "Clear Cut")) %>% 
  group_by(year, section) %>% 
  summarize(abundance = sum(species))
  
# Line plot showing salamander abundances from 1993 (start of monitoring) to present in both clear-cut and old growth forest sections
ggplot(data = salamander_abundance, aes(x = year, y = abundance))+
  geom_line(aes(color = section))+
  theme_classic()+
  theme(legend.position = c(0.2, 0.8)) +
  labs(x = "Year",
       y = "Salamander abundance",
       color = NULL)+
  scale_x_continuous(limits = c(1993, 2017),
                     breaks = c(seq(1993, 2017, by = 2)))+
  scale_y_continuous(limits = c(0, 400), expand = c(0,0))
  
``` 
***Figure 1.*** *Annual abundances of the Pacific Giant Salamander in two standard reaches of Mack Creek in the H.J. Andrews Experimental Forest from 1993 -2017. Salamanders were counted in a reach running through a section of old growth forest (blue line) and a section of historically clear-cut forest (red line).* 

#### B.Table of 2017 salamander counts by channel classification (pool, cascades and side-channel) in old growth (OG) and clear cut (CC) sections of Mack Creek. 

Using only Pacific giant salamander observations from 2017, create a finalized table showing the counts and proportions of salamanders observed in different channel classifications (pool, cascade, or side-channel) within Mack Creek for the two sections (OG and CC). Add a table caption above the table. Note: Weâ€™re only interested in Pacific giant salamanders observed in the creek, so you should exclude salamanders observed in isolated pools (IP) disconnected from the channel. 

```{r}
count_creek_base <- salamander %>% 
  filter(year == "2017" & unittype %in% c("C", "P", "SC")) %>% # keep data in 2017, specific habitat types
  mutate( 
    unittype = case_when(
      unittype == "C" ~ "Cascade",
      unittype == "P" ~ "Pool",
      unittype == "SC" ~ "Side-Channel")) %>% 
  count(section, unittype) %>% 
  pivot_wider(names_from = section, values_from = n)

count_creek <- count_creek_base %>% 
  adorn_percentages(denominator = "col") %>% 
  adorn_pct_formatting(digits = 1) %>% 
  adorn_ns(position = "front")

kable(count_creek, col.names = c("", "Clear Cut", "Old Growth")) %>%
        kable_styling(bootstrap_options = c("striped", "hover"),
                full_width = F,
                position = "float_right") %>% 
add_header_above(c("Table 1: Proportions of giant salamanders \nin different channel classifications \nobserved in two sections of Mack Creek" = 3))

```




#### C.

Another way to ask this: Regarding the locations where salamanders were observed in Mack Creek in 2017, is there a significant effect of forest condition (old growth or clear cut) on where in the channel salamanders are found (channel classification)? Report your statistical findings in text, in the context of the actual counts / proportions you present in the table. 

```{r}
# Is there a significant difference in where in the channel Pacific giant salamanders are located (pool, cascade or side channel) between the two sections (old growth and clear cut)? 
chi_count <- count_creek_base %>% 
  select(-unittype)

chi_count_result <- chisq.test(chi_count)
chi_count_result
```



#### D. 
```{r}
# Is there a significant difference in mean weights for Pacific giant salamanders observed in the two forest sections (clear cut and old growth) in 2017? 

salamander_weight <- salamander %>% 
  filter(year == "2017") %>% 
  select(section, weight) %>% 
  group_by(section) %>% 
  summarize(
    mean_wt = mean(weight, na.rm = TRUE),
    sd_wt = sd(weight, na.rm = TRUE),
    sample_size = n()
  )
```


#### E.

```{r}
# Comparison of salamander weights among habitat type

```


### Summary

### References


